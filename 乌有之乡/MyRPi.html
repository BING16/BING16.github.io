<!doctype html>
<html>
<head>
<meta charset="utf-8">
<title>MyRPi</title>
		<meta name="viewport" content="width=device-width, initial-scale=1" />
		<link rel="stylesheet" href="assets/css/main.css" />
		<style type="text/css">
		body {
	margin-left: 15%;
	margin-right: 15%;
}
        </style>
</head>

<body>
	<div>
		<header>
			<div>
	            <h1>MyRPi</h1>
				<img src="../images/1/MyRPi.jpg" width="240" title="MyRPi">
	            <p class="product-intro">author：QINBINGJIA&nbsp;&nbsp;&nbsp;&nbsp; </br>time：2018.06</br>硬件：RPi3B+ 等</p></div>
		</header>
		<div class="product-content">
     <h2>准备阶段</h2>
     <p>2018.06.13：</p>
	<p>正等待发货</p>
	<p>2018.06.16：</p>
	<p>收到</p>
	<img src="MyRPi/MyRPi.jpg" height="300" title="2018.06.16">
	 <h2>安装系统与SSH、VNC连接</h2>
     <p>2018.06.30[2018.07.05修改]：</p>
	 <ol>
	<li><p>在树莓派官网https://www.raspberrypi.org/下载Raspbian系统映像。</br>据b站up主的提醒及之前安装失败的经验，目前其他系统似乎不支持新出的Pi3B+。</p></li>
	<li><p>借助Win32DiskImager烧录至SD卡，注意烧录好后添加空白的SSH文件以便之后用电脑连接。</br>具体过程参考https://blog.csdn.net/github_38111866/article/details/76038665</p></li>
	<li><p>网线连接树莓派和笔记本，将笔记本的网络共享给树莓派。之后在Windows的cmd命令窗口输入arp -a找到树莓派的IP地址。通过Xshell连接树莓派，用户名为pi，密码为raspberry。</br>具体过程参考https://jingyan.baidu.com/article/adc81513a267c7f723bf7384.html</p></li>
	<li><p>修改软件源为国内软件源，文件地址为/etc/apt/sources.list。[<s>vi编辑器进入后输入i回车即可编辑内容，按Esc后退出内容编辑，而后输入:并回车进入命令行，输入wq回车即可保存并推出vi，若输入q!则不保存直接退出。</br>软件源地址参考网站自https://www.cnblogs.com/xiaowuyi/p/4012069.html</br>vi使用方法参考自https://blog.csdn.net/xie_xiansheng/article/details/78413306</s>]</br>[参考https://blog.csdn.net/la9998372/article/details/77886806]</p></li>
	<li><p>安装vncserver,并开启Raspbian的VNC Server。</br>[<s>参考https://blog.csdn.net/lingyou37/article/details/23671687/及</s>]https://blog.csdn.net/u012952807/article/details/70225700</p></li>
	<li><p>完成连接。</p></li>
	</ol>
	<img src="MyRPi/首次连接vnc.PNG" height="420" title="首次连接vnc">
	<p>之后进行修改时区、分辨率及相关系统美化等操作，相关的参考网址：</br>
	<ul>
	<li>修改时区：https://blog.csdn.net/pjlxm/article/details/79008905</li>
	<li>修改vnc分辨率：https://blog.csdn.net/menghuanbeike/article/details/78065391</li>
	</ul>
	</p>
	<p>2018.07.10：</p>
	<p>系统汉化。</p>
	<h2>CCD相关</h2>
	<p>2018.06.30：</p>
	<p>摄像头测试，样图大小2.4M，效果尚可。</br>摄像头设置参考http://www.mamicode.com/info-detail-2018954.html</p>
	<img src="MyRPi/CCD测试.PNG" height="300" title="CCD测试">
	<p>motion视频设置：https://blog.csdn.net/u013151320/article/details/50195981</br>
	解决视频灰屏问题：http://bbs.elecfans.com/jishu_1099559_1_1.html</br>
	视频存在较大延迟；除笔记本网线直连的情况下，存在外网可访问的安全性问题。</br>
	杀死进程：sudo killall -TERM motion</br>
	启动视频程序：sudo service motion start &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sudo motion</p>
	</div>
	<h2>利用Python3使树莓派自动发送邮件</h2>
	<p>2018.07.13：</p>
	<p>相关代码为</p>
	<pre>
#! /usr/bin/env python
# -*- coding: UTF-8 -*-
import smtplib
from email.mime.text import MIMEText
mailto_list=['12345678@qq.com']           #收件人(列表)
mail_host="smtp.126.com"            #使用的邮箱的smtp服务器地址，这里是163的smtp地址
mail_user="xxx"                           #用户名
mail_pass="xxx"                             #密码
mail_postfix="126.com"                     #邮箱的后缀，网易就是163.com
def send_mail(to_list,sub,content):
    me="hello"+"<"+mail_user+"@"+mail_postfix+">"
    msg = MIMEText(content,_subtype='plain')
    msg['Subject'] = sub
    msg['From'] = me
    msg['To'] = ";".join(to_list)                #将收件人列表以‘；’分隔
    try:
        server = smtplib.SMTP()
        server.connect(mail_host)                            #连接服务器
        server.login(mail_user,mail_pass)               #登录操作
        server.sendmail(me, to_list, msg.as_string())
        server.close()
        return True
    except Exception as e:
        print(e)
        return False
for i in range(1):                             #发送1封，上面的列表是几个人，这个就填几
    if send_mail(mailto_list,"电话","电话是XXX"):  #邮件主题和邮件内容
        #这是最好写点中文，如果随便写，可能会被网易当做垃圾邮件退信
        print ("done!")
    else:
        print ("failed!")
	</pre>
	<h2>修改以上代码后借助Python3自动发送ip地址</h2>
	<p>2018.07.13： </p>
	<p>Python代码为</p>
	<pre>
#!\usr\bin\env python
#-*-coding: utf-8-*-
import socket
import time
import smtplib
import urllib
import urllib.request
from email.mime.multipart import MIMEMultipart
from email.mime.text import MIMEText
from email.mime.image import MIMEImage

#发送邮件的基本函数，参数依次如下
# smtp服务器地址、邮箱用户名，邮箱秘密，发件人地址，收件地址（列表的方式），邮件主题，邮件html内容
def sendEmail(mail_host,mail_user,mail_pass,sender,mailto_list,subject,msghtml):
    me="MRPi"+"<"+sender+">"
    msg = MIMEText(msghtml,_subtype='plain')
    msg['Subject'] = subject
    msg['From'] = me
    msg['To'] = ";".join(mailto_list)                #将收件人列表以‘；’分隔
    try:
        server = smtplib.SMTP()
        server.connect(mail_host)                            #连接服务器
        server.login(mail_user,mail_pass)               #登录操作
        server.sendmail(me, mailto_list, msg.as_string())
        server.close()
        print (True)
    except Exception as e:
        print(e)
        print (False)

#检查网络连通性
def check_network():
    while True:
        try:
            page=urllib.request.urlopen('http://baidu.com')
            html=page.read()
            print (html)
            print ("Network is Ready!")
            break
        except Exception as e:
            print(e)
            print ("Network is not ready,Sleep 5s...")
            time.sleep(5)
    return True

#获取本级制定接口的ip地址
def get_ip_address():
    s =socket.socket(socket.AF_INET,socket.SOCK_DGRAM)
    s.connect(("1.1.1.1",80))
    ipaddr=s.getsockname()[0]
    s.close()
    return ipaddr

if  __name__ == '__main__' :
    check_network()
    ipaddr= get_ip_address()
    print (ipaddr)
    sendEmail("smtp.126.com",'xxx','xxx','xxx@126.com',['12345678@qq.com'],'IP Address of Raspberry PI',ipaddr)
	</pre>
	<p>设置开机自启脚本：<ul><li>sudo vim /etc/rc.local</li><li>添加python3 /home/pi/code/send_ip.py</li></ul></p>
	
<p>&nbsp;</p><p>&nbsp;</p><p>&nbsp;</p><p>&nbsp;</p>
<ul class="icons">
	<li><a href="../乌有之乡.html"><span class="label">back</span></a></li>
					</ul>
</div>
</body>
</html>
